<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>threejs x shader: かすれ - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/takumifukasawa/OiXc -->
<!-- Copyright takumifukasawa - http://jsdo.it/takumifukasawa -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<script id="vertexShader" type="x-shader/v-shader">
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);
    }  
</script>

<script id="fragmentShader" type="x-shader/f-shader">        
    uniform sampler2D texture;
    uniform vec2 resolution;
    uniform float blur;
    varying vec2 vUv;
    
    float getOutlineAlpha() {
        float fx = abs(vUv.x - .5);
        float fy = abs(vUv.y - .5);
        float offset = .48;
        
        float alpha = gl_FragColor.a;
        
        if(fx > offset) {
            float diff = fx - offset;
            alpha *= 1. - diff / (.5 - offset);
        }
        if(fy > offset) {
            float diff = fy - offset;
            alpha *= 1. - diff / (.5 - offset);
        }
        
        return alpha;
    }

    void main() {
        vec4 sum = vec4(0.0);
        
        sum += texture2D( texture, vUv + -10.0 * blur ) * 0.009167927656011385;
        sum += texture2D( texture, vUv +  -9.0 * blur ) * 0.014053461291849008;
        sum += texture2D( texture, vUv +  -8.0 * blur ) * 0.020595286319257878;
        sum += texture2D( texture, vUv +  -7.0 * blur ) * 0.028855245532226279;
        sum += texture2D( texture, vUv +  -6.0 * blur ) * 0.038650411513543079;
        sum += texture2D( texture, vUv +  -5.0 * blur ) * 0.049494378859311142;
        sum += texture2D( texture, vUv +  -4.0 * blur ) * 0.060594058578763078;
        sum += texture2D( texture, vUv +  -3.0 * blur ) * 0.070921288047096992;
        sum += texture2D( texture, vUv +  -2.0 * blur ) * 0.079358891804948081;
        sum += texture2D( texture, vUv +  -1.0 * blur ) * 0.084895951965930902;
        sum += texture2D( texture, vUv +   0.0 * blur ) * 0.086826196862124602;
        sum += texture2D( texture, vUv +  +1.0 * blur ) * 0.084895951965930902;
        sum += texture2D( texture, vUv +  +2.0 * blur ) * 0.079358891804948081;
        sum += texture2D( texture, vUv +  +3.0 * blur ) * 0.070921288047096992;
        sum += texture2D( texture, vUv +  +4.0 * blur ) * 0.060594058578763078;
        sum += texture2D( texture, vUv +  +5.0 * blur ) * 0.049494378859311142;
        sum += texture2D( texture, vUv +  +6.0 * blur ) * 0.038650411513543079;
        sum += texture2D( texture, vUv +  +7.0 * blur ) * 0.028855245532226279;
        sum += texture2D( texture, vUv +  +8.0 * blur ) * 0.020595286319257878;
        sum += texture2D( texture, vUv +  +9.0 * blur ) * 0.014053461291849008;
        sum += texture2D( texture, vUv + +10.0 * blur ) * 0.009167927656011385;
        
        gl_FragColor = sum;
        
       /*
        sum += texture2D(texture, vec2(vUv.x - 4.0*blur, vUv.y)) * 0.05;
        sum += texture2D(texture, vec2(vUv.x - 3.0*blur, vUv.y)) * 0.09;
        sum += texture2D(texture, vec2(vUv.x - 2.0*blur, vUv.y)) * 0.12;
        sum += texture2D(texture, vec2(vUv.x - blur, vUv.y)) * 0.15;
        sum += texture2D(texture, vec2(vUv.x, vUv.y)) * 0.16;
        sum += texture2D(texture, vec2(vUv.x + blur, vUv.y)) * 0.15;
        sum += texture2D(texture, vec2(vUv.x + 2.0*blur, vUv.y)) * 0.12;
        sum += texture2D(texture, vec2(vUv.x + 3.0*blur, vUv.y)) * 0.09;
        sum += texture2D(texture, vec2(vUv.x + 4.0*blur, vUv.y)) * 0.05;

        sum += texture2D(texture, vec2(vUv.x, vUv.y - 4.0*blur)) * 0.05;
        sum += texture2D(texture, vec2(vUv.x, vUv.y - 3.0*blur)) * 0.09;
        sum += texture2D(texture, vec2(vUv.x, vUv.y - 2.0*blur)) * 0.12;
        sum += texture2D(texture, vec2(vUv.x, vUv.y - blur)) * 0.15;
        sum += texture2D(texture, vec2(vUv.x, vUv.y)) * 0.16;
        sum += texture2D(texture, vec2(vUv.x, vUv.y + blur)) * 0.15;
        sum += texture2D(texture, vec2(vUv.x, vUv.y + 2.0*blur)) * 0.12;
        sum += texture2D(texture, vec2(vUv.x, vUv.y + 3.0*blur)) * 0.09;
        sum += texture2D(texture, vec2(vUv.x, vUv.y + 4.0*blur)) * 0.05;
        
        //gl_FragColor = sum / 3.;
        */


        gl_FragColor.a = getOutlineAlpha();

        #ifdef ALPHATEST
            if(gl_FragColor.a < ALPHATEST)
                discard;
            else
                gl_FragColor.a = gl_FragColor.a;
        #endif
    }
</script>

<div id="wrapper"></div>

<input id="blur" type="range" min="0" max="80" />
    

<script src="https://unpkg.com/three@0.84.0/build/three.min.js"></script>
<script src="http://jsrun.it/assets/E/D/W/u/EDWut"></script>
<script src="http://jsrun.it/assets/y/w/Y/L/ywYLf"></script>

<script type="text/javascript" src="index.js"></script>
</body>
</html>
